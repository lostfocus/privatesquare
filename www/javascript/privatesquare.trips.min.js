function privatesquare_trips_datepicker_init(){$(".form-control").focus(function(){var c=$(this).attr("id");if(c=="arrival"){$("#x-calendar-arrival-wrapper").show();$("#x-calendar-departure-wrapper").hide()}else if(c=="departure"){$("#x-calendar-arrival-wrapper").hide();$("#x-calendar-departure-wrapper").show()}else{$("#x-calendar-arrival-wrapper").hide();$("#x-calendar-departure-wrapper").hide()}});var a=document.getElementById("x-calendar-arrival-wrapper").querySelector("x-calendar"),b=document.getElementById("x-calendar-departure-wrapper").querySelector("x-calendar");
a.addEventListener("datetap",function(c){var d=c.detail.date;c=c.detail.iso;$("#arrival").val(c);a.chosen=d;c=d.toISOString();c=c.split("T")[0];b.view=d;b.chosen=d;$("#departure").val(c)});b.addEventListener("datetap",function(c){var d=c.detail.date;c=c.detail.iso;$("#departure").val(c);b.chosen=d;if(a.chosen>d){a.view=d;a.chosen=d;c=d.toISOString();d=c.split("T")[0];$("#arrival").val(d)}})}
function privatesquare_trips_select2_init(){var a=privatesquare_abs_root_url()+"api/rest/";$("#where").select2({minimumInputLength:3,ajax:{url:a,dataType:"json",data:function(b){return{method:"privatesquare.geo.geocode",q:b}},results:function(b){return{results:b.results}}}}).on("select2-opening",function(){$("#x-calendar-arrival-wrapper").hide();$("#x-calendar-departure-wrapper").hide()})}
function privatesquare_trips_gather_trip_info(){var a=$("#where").val(),b=$("#arrival").val(),c=$("#departure").val(),d=$("#arrive_by").val(),e=$("#depart_by").val(),f=$("#status_id").val(),g=$("#note").val();a={woeid:a,arrival:b,departure:c,arrive_by:d,depart_by:e,status_id:f,note:g};if(trip=$("#trip"))a.id=trip.val();return a}
function privatesquare_trips_add_init(){privatesquare_trips_datepicker_init();privatesquare_trips_select2_init();$("#add-trip").submit(function(){var a=$("#add-trip").attr("data-add-trip-crumb"),b=privatesquare_trips_gather_trip_info();b.crumb=a;a=$("#select2-chosen-1").html();$("#add-trip").attr("disabled","disabled");privatesquare_api_call("privatesquare.trips.addTrip",b,_privatesquare_trips_add_trip_onsuccess);privatesquare_set_status("Adding trip to "+htmlspecialchars(a));return false})}
function _privatesquare_trips_add_trip_onsuccess(a){if(a.stat!="ok"){privatesquare_set_status(a.error.error,"danger");$("#add-trip").removeAttr("disabled");return false}location.href=a.trip.trip_url+"?success=1"}
function privatesquare_trips_edit_init(){privatesquare_trips_datepicker_init();$("#trip-editor-show").click(function(){$("#trip-summary").hide();$("#trip-related").hide();$("#trip-editor").show();return false});$("#trip-editor-cancel").click(function(){$("#trip-editor").hide();$("#trip-summary").show();$("#trip-related").show();return false});$("#change-city").click(function(){$(this).hide();privatesquare_trips_select2_init();$("#where").select2("open");return false});$("#edit-trip").submit(function(){$("#where").select2("close");
var a=$("#edit-trip").attr("data-edit-trip-crumb"),b=privatesquare_trips_gather_trip_info();b.crumb=a;privatesquare_api_call("privatesquare.trips.editTrip",b,_privatesquare_trips_edit_trip_onsuccess);privatesquare_set_status("Updating your trip");return false});$("#delete-trip").click(function(){if(!confirm("Are you sure you want to delete this trip?"))return false;var a=$("#edit-trip").attr("data-delete-trip-crumb");a={id:$("#trip").val(),crumb:a};privatesquare_api_call("privatesquare.trips.deleteTrip",
a,_privatesquare_trips_delete_trip_onsuccess);privatesquare_set_status("Deleting your trip");return false})}
function _privatesquare_trips_edit_trip_onsuccess(a){if(a.stat!="ok"){privatesquare_set_status(a.error.error,"danger");return false}a=a.trip;var b=$("#short-name");b.html(a.locality.woe_name);b.attr("href",a.place_url);$("#long-name").html(a.locality.name);b=$("#trip-note");b.html()!=a.note&&b.html(a.note);b=$(".trip-status-str");b.html()!=a.status&&b.html(a.status);b=$(".trip-arrival-str");b.html()!=a.arrival_str&&b.html(a.arrival_str);b=$(".trip-departure-str");b.html()!=a.departure_str&&b.html(a.departure_str);
$("#where").select2("destroy");$("#change-city").show();$("#trip-editor").hide();$("#trip-summary").show();$("#trip-related").show();privatesquare_set_status("Your trip has been updated!")}function _privatesquare_trips_delete_trip_onsuccess(a){if(a.stat!="ok"){privatesquare_set_status(a.error.error,"danger");return false}a=privatesquare_abs_root_url()+"me/trips/?deleted=1";location.href=a};function privatesquare_trips_calendars_select2_init(){var a=privatesquare_abs_root_url()+"user_trips_add_geocode.php";$("#calendar-where").select2({minimumInputLength:3,ajax:{url:a,dataType:"json",data:function(b){return{q:b}},results:function(b){return{results:b.results}}}})}
function privatesquare_trips_calendars_write_init(){privatesquare_trips_calendars_select2_init();$(".form-control").focus(function(){$(this).attr("id")=="calendar-expires"?$("#x-calendar-wrapper").show():$("#x-calendar-wrapper").hide()});document.getElementById("x-calendar-wrapper").querySelector("x-calendar").addEventListener("datetap",function(a){a=a.detail.iso;$("#calendar-expires").val(a)})}
function privatesquare_trips_calendars_add_init(){privatesquare_trips_calendars_write_init();$("#calendar").submit(function(){var a=$("#calendar").attr("data-calendar-crumb"),b=privatesquare_trips_calendars_gather_args();b.crumb=a;privatesquare_api_call("privatesquare.trips.calendars.addCalendar",b,_privatesquare_trips_calendars_add_onsuccess);privatesquare_set_status("Adding calendar...");return false})}
function privatesquare_trips_calendars_edit_init(){privatesquare_trips_calendars_write_init();$("#calendar").submit(function(){var a=$("#calendar").attr("data-calendar-edit-crumb"),b=$(this).attr("data-calendar-id"),c=privatesquare_trips_calendars_gather_args();c.id=b;c.crumb=a;privatesquare_api_call("privatesquare.trips.calendars.editCalendar",c,_privatesquare_trips_calendars_edit_onsuccess);privatesquare_set_status("Updating your calendar...");return false});$("#calendar-delete").click(function(){if(!confirm("Are you sure want to delete this calendar? There is no UNDO."))return false;
var a=$(this),b=a.attr("data-calendar-id");a=a.attr("data-calendar-delete-crumb");privatesquare_api_call("privatesquare.trips.calendars.deleteCalendar",{id:b,crumb:a},_privatesquare_trips_calendars_delete_onsuccess);privatesquare_set_status("Deleting your calendar now...");return false})}
function privatesquare_trips_calendars_gather_args(){var a={},b=$("#calendar-name");a.name=b.val();b=$("#calendar-where");a.woeid=b.val();b=$("#calendar-notes");a.note=b.val();b=$("#calendar-expires");a.expires=b.val();b=$("#calendar-trip-status");a.status_id=b.val();b=$("#calendar-include-notes");a.include_notes=b.attr("checked")?1:0;b=$("#calendar-past-trips");a.past_trips=b&&b.attr("checked")?1:0;return a}
function _privatesquare_trips_calendars_add_onsuccess(a){if(a.stat!="ok"){privatesquare_api_error(a);return false}a=a.calendar.id;htmlspecialchars(a);a=privatesquare_abs_root_url()+"me/trips/calendars/"+a+"?created=1";location.href=a;return false}function _privatesquare_trips_calendars_edit_onsuccess(a){if(a.stat!="ok"){privatesquare_api_error(a);return false}privatesquare_set_status("Okay! Your calendar has been updated.")}
function _privatesquare_trips_calendars_delete_onsuccess(a){if(a.stat!="ok"){privatesquare_api_error(a);return false}a=privatesquare_abs_root_url()+"me/trips/calendars/?deleted=1";location.href=a};
